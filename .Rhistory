eu_up = mean(eu_up),
all_up = mean(all_up)) %>%
arrange(desc(eu_up)) %>%
ggplot(mapping = aes(x = rd_date)) +
geom_line(mapping = aes(y = log(cac_up)), na.rm = T, size = 2, color = 'orange') +
geom_line(mapping = aes(y = log(dax_up)), na.rm = T, size = 2, color = 'dodgerblue') +
geom_line(mapping = aes(y = log(sp_up)), na.rm = T, size = 2, color = 'forestgreen')
library(tidyverse); library(lubridate); library(ggalluvial); library(ggthemes); library(moments); library(ggcorrplot); library(scales)
knitr::opts_chunk$set(message = FALSE)
library(tidyverse); library(lubridate); library(ggalluvial); library(ggthemes); library(moments); library(ggcorrplot); library(scales)
flights <- read_csv(file = 'flights_wide.csv', trim_ws = T)
# airlines_17 <- read_csv(file = 'airlines_17.csv', trim_ws = T)
# airports_17 <- read_csv(file = 'airports_17.csv', trim_ws = T, col_names = c('airport_name', 'airport_iata', 'airport_st'))
## This converts hmm or c(h, mm) to a metric value h.hh
metric_time <- function(horhm, mm = rep(-1, length(horhm))){
if(mm < 0){ return(trunc(horhm/100) + (horhm/100 - trunc(horhm/100)) * 5 / 3) }
else{ return(horhm + mm/60) }
}
## Make metric month function
metric_month <- function(mo, mo_day){ return(mo + (mo_day - 0.5) / max(mo_day)) }
## build a test set
test_17 <- flights %>%
filter(!is.na(dep_delay)) %>% ## Remove flights that are missing dep_delay
group_by(month) %>%
mutate(on_time = dep_delay <= 1, ## This and the next line split the data set into on-time flights...
ln_delay = if_else(dep_delay > 1, log(dep_delay), NA_real_), ## ...and log-length of delay, if delay
diff_5mo = abs(5.31 - month),
wkday = weekdays(time_hour),
month_metric = metric_month(month, day),  ## Using my function
time_metric = metric_time(sched_dep_time), ## Using my function
diff_21h = abs(21.45 - time_metric)) %>%
ungroup() %>%
select(-(1:5), -(7:9), -(11:12), -(hour:minute)) %>%
left_join(weather, by = c('time_hour', 'origin'))
flights %>%
filter(!is.na(dep_delay))
test_17 <- flights %>%
filter(!is.na(dep_delay)) %>% ## Remove flights that are missing dep_delay
mutate(month = month(time_hour)) %>%
group_by(month) %>%
mutate(on_time = dep_delay <= 1, ## This and the next line split the data set into on-time flights...
ln_delay = if_else(dep_delay > 1, log(dep_delay), NA_real_), ## ...and log-length of delay, if delay
diff_5mo = abs(5.31 - month),
wkday = weekdays(time_hour),
month_metric = metric_month(month, day),  ## Using my function
time_metric = metric_time(sched_dep_time), ## Using my function
diff_21h = abs(21.45 - time_metric)) %>%
ungroup() %>%
select(-(1:5), -(7:9), -(11:12), -(hour:minute)) %>%
left_join(weather, by = c('time_hour', 'origin'))
flights %>%
filter(!is.na(dep_delay)) %>% ## Remove flights that are missing dep_delay
mutate(month = month(time_hour))
test_17 <- flights %>%
filter(!is.na(dep_delay)) %>% ## Remove flights that are missing dep_delay
mutate(month = month(time_hour),
day = day(time_hour)) %>%
group_by(month) %>%
mutate(on_time = dep_delay <= 1, ## This and the next line split the data set into on-time flights...
ln_delay = if_else(dep_delay > 1, log(dep_delay), NA_real_), ## ...and log-length of delay, if delay
diff_5mo = abs(5.31 - month),
wkday = weekdays(time_hour),
month_metric = metric_month(month, day),  ## Using my function
time_metric = metric_time(sched_dep_time), ## Using my function
diff_21h = abs(21.45 - time_metric)) %>%
ungroup()
test_17
## Build a correlogram
test_17 %>%
filter(carrier == 'B6') %>%
select(on_time:ln_delay,
air_time:distance,
month_metric:time_metric,
temp:visib) %>%
cor(use = "pairwise.complete.obs") %>%
round(0) %>%
ggcorrplot(lab = TRUE,
#method="circle",
type = "lower",
lab_size = 3,
colors = c("orange", "white", "dodgerblue"),
title="Correlogram of flight and weather data",
ggtheme = theme_bw())
## Build a correlogram
test_17 %>%
filter(carrier == 'B6') %>%
select(on_time:ln_delay,
air_time:distance,
month_metric:time_metric,
temp:visib) %>%
cor(use = "pairwise.complete.obs") %>%
round(1) %>%
ggcorrplot(lab = TRUE,
#method="circle",
type = "lower",
lab_size = 3,
colors = c("orange", "white", "dodgerblue"),
title="Correlogram of flight and weather data",
ggtheme = theme_bw())
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
ggtitle('Each airline has experienced cost growth but none more than JetBlue')
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin[13:16,1] <- 'United'
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin[13:16,1] <- 'United'
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
ggtitle('Each airline has experienced cost growth but none more than JetBlue')
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
subtitle = 'Cost growth per year in percent')
library(tidyverse); library(lubridate); library(ggalluvial); library(ggthemes); library(moments); library(ggcorrplot); library(scales)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
include = FALSE
)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
include = FALSE
)
flights <- read_csv(file = 'flights_wide.csv', trim_ws = T)
pred_17 %>%
select(diff_21h, time_metric, pred_delay) %>%
unique() %>%
ggplot() +
geom_point(mapping = aes(time_metric, p_on_time, color = 'time'), size = 1) +
geom_smooth(aes(time_metric, p_on_time, color = 'time'), method = 'loess') +
geom_point(mapping = aes(diff_21h, p_on_time, color = 'adj_time'), size = 1) +
geom_smooth(aes(diff_21h, p_on_time, color = 'adj_time'), method = 'loess') +
theme_bw()
air_fin[13:16,1]
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
subtitle = 'Cost growth per year in percent')
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption =  = 'Cost growth per year in percent')
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Cost growth per year in percent')
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = percent_format(exp_growth, accuracy = 0), fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent')
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 1))
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 0))
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 1))
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin[13:16,1] <- 'UAL'
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 1))
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_area(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 1))
col
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 1))
library(tidyverse); library(lubridate); library(ggalluvial); library(ggthemes); library(moments); library(ggcorrplot); library(scales)
# pred_17 %>%
#   select(diff_21h, time_metric, pred_delay) %>%
#   unique() %>%
#   ggplot() +
#   geom_point(mapping = aes(time_metric, p_on_time, color = 'time'), size = 1) +
#   geom_smooth(aes(time_metric, p_on_time, color = 'time'), method = 'loess') +
#   geom_point(mapping = aes(diff_21h, p_on_time, color = 'adj_time'), size = 1) +
#   geom_smooth(aes(diff_21h, p_on_time, color = 'adj_time'), method = 'loess') +
#   theme_bw()
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
include = FALSE
)
library(tidyverse); library(lubridate); library(ggalluvial); library(ggthemes); library(moments); library(ggcorrplot); library(scales)
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin[13:16,1] <- 'UAL'
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 1))
flights <- read_csv(file = 'flights_wide.csv', trim_ws = T)
# airlines_17 <- read_csv(file = 'airlines_17.csv', trim_ws = T)
# airports_17 <- read_csv(file = 'airports_17.csv', trim_ws = T, col_names = c('airport_name', 'airport_iata', 'airport_st'))
## build a test set
test_17 <- flights %>%
filter(!is.na(dep_delay)) %>% ## Remove flights that are missing dep_delay
mutate(month = month(time_hour),
day = day(time_hour)) %>%
group_by(month) %>%
mutate(on_time = dep_delay <= 1, ## This and the next line split the data set into on-time flights...
ln_delay = if_else(dep_delay > 1, log(dep_delay), NA_real_), ## ...and log-length of delay, if delay
diff_5mo = abs(5.31 - month),
wkday = weekdays(time_hour),
month_metric = metric_month(month, day),  ## Using my function
time_metric = metric_time(sched_dep_time), ## Using my function
diff_21h = abs(21.45 - time_metric)) %>%
ungroup()
## Build a correlogram
test_17 %>%
filter(carrier == 'B6') %>%
select(on_time:ln_delay,
air_time:distance,
month_metric:time_metric,
temp:visib) %>%
cor(use = "pairwise.complete.obs") %>%
round(1) %>%
ggcorrplot(lab = TRUE,
#method="circle",
type = "lower",
lab_size = 3,
colors = c("orange", "white", "dodgerblue"),
title="Correlogram of flight and weather data",
ggtheme = theme_bw())
test_17 %>%
filter(carrier == 'B6', !is.na(dewp)) %>%
ggplot(mapping = aes(x = temp, y = dewp)) +
geom_smooth(method = 'lm', color = 'darkgray', fill = 'darkgray', alpha = 0.8) +
geom_count(color = 'dodgerblue', show.legend = F, na.rm = T) +
theme_bw() +
labs(title = "The correlation between temperature and dewpoint makes using both redundant",
x = "temperature in degrees",
y = "dewpoint in degrees")
test_17 %>%
mutate(is_b6 = (carrier == 'B6')) %>%
mutate(month_metric = round(month_metric, 1)) %>%
group_by(month_metric, is_b6) %>%
summarize(mean_on_time = mean(on_time)) %>%
group_by(month_metric) %>%
mutate(b6_v_others = if_else(2 * is_b6 == 2,
mean_on_time - mean(mean_on_time),
mean(mean_on_time) - mean_on_time)) %>%
summarize(b6_factor = sum(b6_v_others)) %>%
ggplot(mapping = aes(x = month_metric - 0.5, ymax = b6_factor, ymin = 0)) +
geom_ribbon(fill = 'dodgerblue') +
scale_x_continuous(labels = month.abb[1:12], breaks = 1:12) +
theme_bw() +
labs(title = 'JetBlue lags in on-time departures all year but especially in summer months',
x = 'date',
y = 'on-time departures vs competitors')
test_17 %>%
filter(carrier %in% c('AA', 'B6', 'DL', 'UA') &
!is.na(ln_delay)) %>%
group_by(carrier) %>%
summarize(q1 = quantile(dep_delay, 0.25),
q3 = quantile(dep_delay, 0.75)) %>%
ggplot(mapping = aes(x = q1, xend = q3, y = carrier)) +
geom_dumbbell(colour_x = "dodgerblue",
size = 2,
size_x = 4,
size_xend = 4,
colour_xend = "darkblue",
colour = 'dodgerblue') +
labs(x = NULL,
y = NULL,
title = "Departure delay interquartile range is longest for JetBlue on both ends") +
scale_x_continuous(label = minutes) +
theme_excel_new() +
theme(plot.title = element_text(face = "bold"),
panel.grid.major.x=element_line(),
axis.ticks=element_blank(),
panel.border=element_blank())
opts_chunk$set(
message = FALSE,
warning = FALSE,
include = FALSE
)
library(tidyverse); library(lubridate); library(ggalluvial); library(ggthemes); library(moments); library(ggcorrplot); library(scales); library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
include = FALSE
)
opts_chunk$set(
message = FALSE,
warning = FALSE,
include = FALSE
)
library(tidyverse); library(lubridate); library(ggalluvial); library(ggthemes); library(moments); library(ggcorrplot); library(scales); library(knitr)
opts_chunk$set(message = FALSE, warning = FALSE)
read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
read_csv('air_fin_raw.csv')
read_csv('air_fin_raw.csv')
air_fin %>%
filter(!is.na(exp_growth)) %>%
ggplot() +
geom_col(mapping = aes(x = year, y = exp_growth, fill = year)) +
facet_wrap(facets = ~carrier, nrow = 1) +
theme_excel_new() +
theme(legend.position = "none") +
labs(title = 'Each airline has experienced cost growth but none more than JetBlue',
caption = 'Annual operation cost growth per year in percent') +
scale_y_continuous(labels = percent_format(accuracy = 1))
air_fin_raw <- read_csv('air_fin_raw.csv')
air_fin_raw
air_fin_raw <- read_csv('air_fin_raw.csv')
air_fin_raw
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd")
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd") %>%
mutate(date = mdy(date))
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd") %>%
mutate(date = mdy(date))
air_fin
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd")
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd")
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd") %>%
spread(key = 2, value = 4)
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd") %>%
spread(key = 2, value = 4) %>%
mutate(date = mdy(date))
air_fin
air_fin_raw %>%
gather(-(1:2), key = "date", value = "amt_1000usd") %>%
spread(key = 2, value = 4) %>%
mutate(date = mdy(date))
air_fin <- read_csv('air_fin.csv',na = '', col_names = c('carrier', 'year', 'opn_exp', 'opn_inc', 'exp_growth', 'inc_growth'), skip = 1)
air_fin
library(lubridate)
library(data.table)
library(tidyverse)
library(jsonlite)
library(ggrepel)
library(stringr)
all_data <- "https://covidtracking.com/api/v1/states/daily.json" %>%
fromJSON() %>%
as.data.table()
my_data <- all_data %>%
mutate(as_of = ymd(date)) %>%
select(as_of,
code = state,
cases = positive,
case_ch = positiveIncrease,
death,
death_ch = deathIncrease)
st_pop_2019 <- read_csv("st_pop.csv") %>%
select(name = 5, pop_2019 = 17) %>%
mutate(pop_2019 = as.integer(pop_2019))
code_names <- data.table(cbind(name = state.name,
code = state.abb,
region = as.character(state.region)))
death_growth <- code_names %>%
inner_join(st_pop_2019) %>%
inner_join(my_data) %>%
group_by(code) %>%
filter(as_of > as_date(ymd_hms(now())) - 7) %>%
summarize(death_weekly_growth = round((max(death) - min(death)) / min(death), 2), death_weekly_per_mil = signif(sum(death_ch) / mean(pop_2019) * 1000000, 3), wk_ending = max(as_of)) %>%
arrange(desc(death_weekly_growth))
case_growth <- code_names %>%
inner_join(st_pop_2019) %>%
inner_join(my_data) %>%
group_by(code) %>%
filter(as_of > as_date(ymd_hms(now())) - 7) %>%
summarize(cases_weekly_growth = round((max(cases) - min(cases)) / min(cases), 2), cases_weekly_per_mil = signif(((max(cases) - min(cases)) / mean(pop_2019) * 1000000), 3), wk_ending = max(as_of)) %>%
arrange(desc(cases_weekly_growth))
death_growth %>%
inner_join(case_growth) %>%
inner_join(code_names) %>%
arrange(desc(death_weekly_per_mil)) %>%
filter(death_weekly_per_mil > quantile(death_growth$death_weekly_per_mil, probs = 0.8)) %>%
ggplot() +
geom_col(mapping = aes(x = reorder(code, X = desc(death_weekly_per_mil)), y = death_weekly_per_mil, fill = region)) +
labs(x = "state", y = "Weekly deaths per million residents", title = stringr::str_c("States with most deaths per million the week ending", death_growth$wk_ending[1], sep = " "))
death_growth %>%
inner_join(code_names) %>%
ggplot(mapping = aes(x = death_weekly_growth, y = death_weekly_per_mil, color = region)) +
## geom_point() +
ggrepel::geom_text_repel(mapping = aes(label = code)) +
labs(x = "Weekly death growth rate", y = "Weekly deaths per million", title = "Deaths over the past week per million and growth in deaths",
subtitle = "Shows states having a hard time now and those who may face hard times soon")
case_growth %>%
inner_join(code_names) %>%
ggplot(mapping = aes(x = cases_weekly_growth, y = cases_weekly_per_mil, color = region)) +
## geom_point() +
ggrepel::geom_text_repel(mapping = aes(label = code)) +
labs(x = "Weekly case growth rate", y = "Weekly new cases per million", title = "Cases over the past week per million and growth in cases",
subtitle = "Shows states having a hard time now and those who may face hard times soon")
my_data %>%
filter(code == 'NY', as_of > ymd("2020-03-14")) %>%
ggplot(mapping = aes(x = as_of, y = death_ch)) +
geom_smooth(linetype = "dashed") +
geom_line(size = 1) +
labs(title = "Deaths per day in New York since mid-March", x = "date", y = "COVID-19 deaths")
my_data %>%
filter(code == 'NY', as_of > ymd("2020-03-14")) %>%
ggplot(mapping = aes(x = as_of, y = case_ch)) +
geom_smooth(linetype = "dashed") +
geom_line()
top_frac(death_growth, n = 0.4) %>%
inner_join(top_frac(case_growth, n = 0.4)) %>%
inner_join(code_names) %>%
filter((death_weekly_per_mil > as.numeric(reorder(death_growth$death_weekly_per_mil, desc(death_growth$death_weekly_per_mil))[[11]])) |
(cases_weekly_per_mil > as.numeric(reorder(case_growth$cases_weekly_per_mil, desc(case_growth$cases_weekly_per_mil))[[11]]))) %>%
ggplot(mapping = aes(x = death_weekly_per_mil, y = cases_weekly_per_mil)) +
geom_smooth(method = "lm", mapping = aes(color = NULL), linetype = "dotted", fill = 0.1, color = "lightgray") +
## geom_point(mapping = aes(color = region), size = 2) +
ggrepel::geom_text_repel(mapping = aes(label = code, color = region)) +
labs(x = "Weekly deaths per million", y = "Weekly new cases per million")
death_growth %>%
inner_join(case_growth) %>%
inner_join(code_names) %>%
filter((death_weekly_growth > death_growth$death_weekly_growth[11]) | (cases_weekly_growth > case_growth$cases_weekly_growth[11])) %>%
ggplot(mapping = aes(x = death_weekly_growth, y = cases_weekly_growth, color = region)) +
geom_point() +
ggrepel::geom_label_repel(mapping = aes(label = code)) +
labs(x = "Weekly growth in deaths", y = "Weekly growth in cases")
