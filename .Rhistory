inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(2)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == min(as_of), pos_rate, NULL)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate, color = pos_rate)) +
geom_line() +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(code), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(2)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate, NULL)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate, color = pos_rate)) +
geom_line() +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(code), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(2)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.1, NULL)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate, color = pos_rate)) +
geom_line() +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(code), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(2)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.2, NULL)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate, color = pos_rate)) +
geom_line() +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(code), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.2, NULL)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate, color = pos_rate)) +
geom_line() +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(code), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names) %>%
inner_join(st_pop_2019) %>%
group_by(reg_2) %>%
filter(as_of > Sys.Date() - months(1)) %>%
# wday(as_of) == wday(max(as_of)),
ungroup() %>%
group_by(reg_2, as_of) %>%
summarize(case_sum = sum(case_ch) / sum(pop_2019) * 1000000)
my_data %>%
inner_join(code_names) %>%
inner_join(st_pop_2019) %>%
group_by(reg_2) %>%
filter(as_of > Sys.Date() - months(1)) %>%
# wday(as_of) == wday(max(as_of)),
ungroup() %>%
group_by(reg_2, as_of) %>%
summarize(case_sum = sum(case_ch) / sum(pop_2019) * 1000000) %>%
ggplot() +
geom_smooth(mapping = aes(x = as_of, y = case_sum, color = reg_2, fill = reg_2), alpha = .1)
case_growth$wk_ending[1]
my_data %>%
inner_join(code_names) %>%
inner_join(st_pop_2019) %>%
group_by(reg_2) %>%
filter(as_of > Sys.Date() - months(1)) %>%
# wday(as_of) == wday(max(as_of)),
ungroup() %>%
group_by(reg_2, as_of) %>%
summarize(case_sum = sum(case_ch) / sum(pop_2019) * 1000000) %>%
ggplot() +
geom_smooth(mapping = aes(x = as_of, y = case_sum, color = reg_2, fill = reg_2), alpha = .1) +
labs(x = "Date", y = "New cases per million", title = "New cases drop sharply in the northeast while the south rises again", subtitle = str_c("Month ending ", case_growth$wk_ending[1]))
my_data %>%
inner_join(code_names) %>%
inner_join(st_pop_2019) %>%
group_by(reg_2) %>%
filter(as_of > Sys.Date() - months(1)) %>%
# wday(as_of) == wday(max(as_of)),
ungroup() %>%
group_by(reg_2, as_of) %>%
summarize(case_sum = sum(case_ch) / sum(pop_2019) * 1000000) %>%
ggplot() +
geom_smooth(mapping = aes(x = as_of, y = case_sum, color = reg_2, fill = reg_2), alpha = .1) +
labs(x = "Date", y = "New cases per million", title = "New cases drop sharply in the northeast while the south rises again", subtitle = str_c("Month ending ", case_growth$wk_ending[1])) +
theme(legend.title=element_blank())
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.2, NULL))
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.2, NULL),
pos_month = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate, color = pos_rate)) +
geom_line() +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.2, NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate, color = pos_rate)) +
geom_line() +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.2, NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.1, NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_text(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of))) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.1, NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 4) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate + 0.1, NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), pos_rate, NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), 1 - pos_rate, NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), 1 - mean(pos_rate, 0.5), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), abs(pos_rate - 0.5), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), max(pos_rate), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), median(pos_rate), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), median(pos_rate), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0, span = .1) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), median(pos_rate), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0, span = .2) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), median(pos_rate), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0, span = .5) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
6
my_data %>%
inner_join(code_names, by = "code") %>%
inner_join(st_pop_2019, by = "name") %>%
filter(as_of >= Sys.Date() - months(1)) %>%
mutate(week_num = lubridate::week(as_of)) %>%
group_by(week_num, code) %>%
summarize(pos_rate = sum(case_ch) / sum(test_ch),
as_of = median(as_of)) %>%
group_by(code) %>%
mutate(y_label = if_else(as_of == median(as_of), median(pos_rate), NULL),
month_pos = mean(pos_rate, na.rm = TRUE)) %>%
ggplot(mapping = aes(x = as_of, y = pos_rate)) +
geom_smooth(alpha = 0, span = .6) +
geom_label(mapping = aes(x = as_of, y = y_label, label = code), na.rm = TRUE) +
labs(x = "Date", y = "Share of COVID-19 tests with positive results", title = "Positive rates are increasing in some states", subtitle = str_c(lubridate::floor_date(Sys.Date() - months(2), unit = "month"), " through ", max(my_data$as_of), "; Ordered by highest positive rate for the month")) +
theme(legend.title = element_blank()) +
facet_wrap(facets = vars(reorder(code, desc(month_pos))), nrow = 5) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title.x  = element_blank(),
strip.text.x = element_blank(),
legend.position = 0)
